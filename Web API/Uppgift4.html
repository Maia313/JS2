<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Search people</title>
    <script src="Web_api.js"></script>
</head>

<body>
    <input type="text" id="searchValue" />

    <input type="button" id="searchButton" value="Search people" onclick="SearchPeople()" />
    <br><br>

    <h3 id="dataFromCall">


    </h3>

    <script type="text/javascript">
        function SearchPeople() {
            //Ta emot sökvärdet från textboxen
            let searchText = document.getElementById("searchValue").value;

            responseHandler(searchText);
        }

        async function responseHandler(searchText) {

            let url = 'https://swapi.co/api/people/?search=' + searchText;

            //Hämta data från web api:et
            var response = await fetchData(url);

            //Gör om strängen som returneras till JSON
            let allPeople = JSON.parse(response);

            //Om det inte finns några träffar
            if (allPeople.count == "0") {
                document.getElementById("dataFromCall").innerHTML = "No people matched search";
            } else {
                //Töm gamla sökresultatet
                document.getElementById("dataFromCall").innerHTML = "";

                //SKapa ett nytt listobjekt
                var myList = document.createElement('ul');
                var text;

                //Gå igenom alla personer i sökresultatet och lägg till i listan
                for (let person of allPeople.results) {
                    //Skapa listrad
                    let listRow = document.createElement('li');

                    //Lägg till personens namn på listraden
                    text = document.createTextNode(person.name);

                    //Koppla texten till listraden
                    listRow.appendChild(text);

                    //Lägg till listraden till listan
                    myList.appendChild(listRow);
                }

                //Lägg in hela listan i diven
                document.getElementById("dataFromCall").appendChild(myList);
            }
        }
    </script>


</body>

</html>